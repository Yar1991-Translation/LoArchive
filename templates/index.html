<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoArchive</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
:root{--md3-primary:#00bcd4;--md3-on-primary:#fff;--md3-primary-container:#b2ebf2;--md3-on-primary-container:#002021;--md3-secondary:#26c6da;--md3-on-secondary:#fff;--md3-secondary-container:#e0f7fa;--md3-on-secondary-container:#002021;--md3-background:#f0fdfa;--md3-on-background:#002021;--md3-surface:#fff;--md3-on-surface:#1a1a1a;--md3-surface-variant:#e8f5f3;--md3-outline:#006064;--md3-outline-variant:#b2ebf2;--md3-error:#b00020;--md3-on-error:#fff;--color-success:#00897b;--color-warning:#ff9800;--color-info:#0288d1;--text-primary:#1a1a1a;--text-secondary:#424242;--text-muted:#757575;--shadow-sm:0 1px 3px rgba(0,188,212,.08);--shadow-md:0 4px 12px rgba(0,188,212,.12);--shadow-lg:0 8px 24px rgba(0,188,212,.16);--shadow-xl:0 16px 48px rgba(0,188,212,.2);--radius-sm:8px;--radius-md:12px;--radius-lg:16px;--radius-xl:24px;--radius-full:9999px;--titlebar-height:42px;--sidebar-width:280px;--transition-fast:.15s cubic-bezier(.4,0,.2,1);--transition-normal:.25s cubic-bezier(.4,0,.2,1)}*{margin:0;padding:0;box-sizing:border-box}html,body{height:100%;overflow:hidden}body{font-family:'Noto Sans SC',-apple-system,BlinkMacSystemFont,system-ui,sans-serif;background:var(--md3-background);color:var(--text-primary);line-height:1.6;-webkit-font-smoothing:antialiased}.titlebar{height:var(--titlebar-height);background:linear-gradient(180deg,var(--md3-surface) 0%,#f8fffe 100%);border-bottom:1px solid var(--md3-outline-variant);display:flex;align-items:center;justify-content:space-between;position:fixed;top:0;left:0;right:0;z-index:10000;-webkit-app-region:drag;user-select:none}.titlebar-left{display:flex;align-items:center;padding-left:16px;gap:12px}.titlebar-logo{width:28px;height:28px;background:linear-gradient(135deg,var(--md3-primary) 0%,var(--md3-secondary) 100%);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;font-size:14px;color:#fff;box-shadow:var(--shadow-sm)}.titlebar-title{font-size:13px;font-weight:500;color:var(--text-secondary);letter-spacing:.3px}.titlebar-controls{display:flex;align-items:center;height:100%;padding-right:8px;gap:6px;-webkit-app-region:no-drag}.titlebar-btn{width:36px;height:36px;border:none;background:var(--md3-surface-variant);border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all var(--transition-normal)}.titlebar-btn:active{transform:scale(.92)}.titlebar-btn.btn-minimize{color:var(--md3-primary)}.titlebar-btn.btn-minimize:hover{background:var(--md3-primary-container);box-shadow:0 2px 8px rgba(0,188,212,.25)}.titlebar-btn.btn-maximize{color:var(--color-success)}.titlebar-btn.btn-maximize:hover{background:#e0f2f1;box-shadow:0 2px 8px rgba(0,137,123,.25)}.titlebar-btn.btn-close{color:#e57373}.titlebar-btn.btn-close:hover{background:#ffebee;color:var(--md3-error);box-shadow:0 2px 8px rgba(176,0,32,.25)}.titlebar-btn svg{width:12px;height:12px;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;fill:none}.app-container{height:100%;padding-top:var(--titlebar-height);display:flex;background:var(--md3-background)}.sidebar{width:var(--sidebar-width);background:var(--md3-surface);border-right:1px solid var(--md3-outline-variant);display:flex;flex-direction:column;flex-shrink:0}.sidebar-header{padding:24px 20px;border-bottom:1px solid var(--md3-outline-variant);background:linear-gradient(135deg,var(--md3-surface-variant) 0%,var(--md3-surface) 100%)}.brand{display:flex;align-items:center;gap:14px}.brand-icon{width:48px;height:48px;background:linear-gradient(135deg,var(--md3-primary) 0%,#0097a7 100%);border-radius:var(--radius-md);display:flex;align-items:center;justify-content:center;font-size:24px;color:#fff;box-shadow:var(--shadow-md)}.brand-text h1{font-size:17px;font-weight:600;color:var(--text-primary);margin-bottom:3px}.brand-text p{font-size:12px;color:var(--text-muted)}.sidebar-nav{flex:1;padding:16px 12px;overflow-y:auto}.nav-section-title{font-size:11px;font-weight:600;color:var(--text-muted);text-transform:uppercase;letter-spacing:.8px;padding:12px 14px 8px;margin-top:8px}.nav-section-title:first-child{margin-top:0}.nav-item{display:flex;align-items:center;gap:14px;padding:14px 16px;border-radius:var(--radius-lg);cursor:pointer;transition:background-color .15s ease;margin-bottom:4px;position:relative}.nav-item::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:4px;height:0;background:var(--md3-primary);border-radius:0 4px 4px 0;transition:height var(--transition-normal)}.nav-item:hover{background:var(--md3-surface-variant)}.nav-item.active{background:var(--md3-primary-container)}.nav-item.active::before{height:24px}.nav-item.active .nav-icon{color:var(--md3-primary)}.nav-item.active .nav-label{color:var(--md3-on-primary-container);font-weight:600}.nav-icon{font-size:22px;width:32px;text-align:center}.nav-label{font-size:14px;font-weight:500;color:var(--text-secondary)}.sidebar-footer{padding:16px;border-top:1px solid var(--md3-outline-variant);background:var(--md3-surface-variant)}.status-card{background:var(--md3-surface);border-radius:var(--radius-md);padding:16px;border:1px solid var(--md3-outline-variant)}.status-row{display:flex;align-items:center;justify-content:space-between;font-size:13px}.status-row+.status-row{margin-top:10px;padding-top:10px;border-top:1px dashed var(--md3-outline-variant)}.status-label{color:var(--text-muted);font-weight:500}.status-value{font-weight:600;color:var(--text-primary);display:flex;align-items:center;gap:6px}.status-value.success{color:var(--color-success)}.status-value.error{color:var(--md3-error)}.status-dot{width:8px;height:8px;border-radius:50%;background:var(--color-success);animation:pulse 2s infinite}.status-dot.running{background:var(--color-warning)}@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.6;transform:scale(.9)}}.main-content{flex:1;overflow-y:auto;padding:28px 36px;background:var(--md3-background)}.panel{display:none;animation:fadeSlideIn .2s cubic-bezier(.2,0,.2,1)}.panel.active{display:block}@keyframes fadeSlideIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}.panel-header{margin-bottom:28px}.panel-title{font-size:24px;font-weight:600;color:var(--text-primary);display:flex;align-items:center;gap:12px}.panel-title-icon{width:40px;height:40px;background:var(--md3-primary-container);border-radius:var(--radius-md);display:flex;align-items:center;justify-content:center;font-size:20px}.mode-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:14px;margin-bottom:28px}.mode-card{background:var(--md3-surface);border:2px solid var(--md3-outline-variant);border-radius:var(--radius-lg);padding:24px 18px;text-align:center;cursor:pointer;transition:border-color .15s ease,transform .1s ease,box-shadow .15s ease;position:relative;overflow:hidden}.mode-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--md3-primary);transform:scaleX(0);transition:transform var(--transition-normal)}.mode-card:hover{border-color:var(--md3-primary);transform:translateY(-3px);box-shadow:var(--shadow-md)}.mode-card:hover::before{transform:scaleX(1)}.mode-card.selected{border-color:var(--md3-primary);background:var(--md3-primary-container);box-shadow:var(--shadow-lg)}.mode-card.selected::before{transform:scaleX(1)}.mode-card-icon{font-size:36px;margin-bottom:10px}.mode-card-name{font-size:14px;font-weight:600;color:var(--text-primary)}.mode-card.selected .mode-card-name{color:var(--md3-on-primary-container)}.form-card{background:var(--md3-surface);border-radius:var(--radius-xl);padding:32px;border:1px solid var(--md3-outline-variant);box-shadow:var(--shadow-sm)}.form-group{margin-bottom:24px;position:relative}.form-group:last-child{margin-bottom:0}.form-label{display:block;font-size:14px;font-weight:600;color:var(--text-primary);margin-bottom:10px}.form-hint{font-size:12px;color:var(--text-muted);margin-top:8px;line-height:1.5}.form-input{width:100%;padding:16px 18px;background:var(--md3-surface-variant);border:2px solid transparent;border-radius:var(--radius-md);font-size:14px;font-family:inherit;color:var(--text-primary);transition:all var(--transition-fast);appearance:none}.form-input:hover{background:var(--md3-secondary-container)}.form-input:focus{outline:none;background:var(--md3-surface);border-color:var(--md3-primary);box-shadow:0 0 0 4px rgba(0,188,212,.15)}.form-input::placeholder{color:var(--text-muted)}textarea.form-input{min-height:110px;resize:vertical;line-height:1.6}select.form-input{padding-right:40px;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23006064' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;background-size:18px;cursor:pointer}.checkbox-group{display:flex;flex-wrap:wrap;gap:10px}.checkbox-item{display:flex;align-items:center;gap:10px;padding:12px 18px;background:var(--md3-surface-variant);border-radius:var(--radius-md);cursor:pointer;transition:all var(--transition-fast);border:2px solid transparent}.checkbox-item:hover{background:var(--md3-secondary-container);border-color:var(--md3-secondary)}.checkbox-item:has(input:checked){background:var(--md3-primary-container);border-color:var(--md3-primary)}.checkbox-item input[type="checkbox"]{appearance:none;width:20px;height:20px;border:2px solid var(--md3-outline);border-radius:6px;margin:0;position:relative;transition:all var(--transition-fast);background:#fff;cursor:pointer}.checkbox-item input[type="checkbox"]:checked{background-color:var(--md3-primary);border-color:var(--md3-primary)}.checkbox-item input[type="checkbox"]:checked::after{content:'';position:absolute;left:5px;top:1px;width:6px;height:11px;border:solid #fff;border-width:0 2px 2px 0;transform:rotate(45deg)}.checkbox-item span{font-size:14px;font-weight:500;color:var(--text-primary)}.checkbox-item:has(input:checked) span{color:var(--md3-on-primary-container);font-weight:600}.btn{display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:16px 32px;border:none;border-radius:var(--radius-full);font-size:15px;font-weight:600;font-family:inherit;cursor:pointer;transition:all var(--transition-normal);position:relative;overflow:hidden;text-transform:uppercase;letter-spacing:.5px}.btn-primary{background:linear-gradient(135deg,var(--md3-primary) 0%,#0097a7 100%);color:var(--md3-on-primary);box-shadow:0 4px 16px rgba(0,188,212,.4)}.btn-primary:hover{transform:translateY(-1px);box-shadow:0 6px 16px rgba(0,188,212,.3)}.btn-primary:active{transform:scale(.98)}.btn-primary:disabled{background:var(--md3-surface-variant);color:var(--text-muted);cursor:not-allowed;transform:none;box-shadow:none}.btn-block{width:100%}.btn-icon{font-size:18px}.progress-section{margin-top:28px;display:none}.progress-section.active{display:block}.progress-card{background:var(--md3-surface);border-radius:var(--radius-lg);padding:24px;border:1px solid var(--md3-outline-variant);margin-bottom:16px}.progress-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.progress-title{font-size:14px;font-weight:600;color:var(--text-primary)}.progress-percent{font-size:16px;font-weight:700;color:var(--md3-primary)}.progress-bar{height:10px;background:var(--md3-surface-variant);border-radius:var(--radius-full);overflow:hidden}.progress-fill{height:100%;background:linear-gradient(90deg,var(--md3-primary),var(--md3-secondary));border-radius:var(--radius-full);transition:width .3s ease;position:relative}.progress-fill::after{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.4),transparent);animation:shimmer 1.5s infinite}@keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}.log-container{background:#1a2332;border-radius:var(--radius-lg);overflow:hidden;box-shadow:var(--shadow-md);border:1px solid #2a3445}.log-header{padding:14px 18px;background:#141c28;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,.05)}.log-header-title{font-size:13px;font-weight:600;color:#8ec8d8;display:flex;align-items:center;gap:8px}.log-content{padding:18px;max-height:300px;overflow-y:auto;font-family:'JetBrains Mono','Fira Code',Consolas,monospace;font-size:12px;line-height:1.8;color:#a8c0c8}.log-line{padding:4px 8px;border-radius:4px;margin-bottom:2px;border-left:2px solid transparent}.log-line:hover{background:rgba(0,188,212,.08);border-left-color:var(--md3-primary)}.settings-section{background:var(--md3-surface);border-radius:var(--radius-lg);padding:28px;border:1px solid var(--md3-outline-variant);margin-bottom:20px}.settings-title{font-size:17px;font-weight:600;color:var(--text-primary);margin-bottom:24px;display:flex;align-items:center;gap:10px;padding-bottom:16px;border-bottom:1px solid var(--md3-outline-variant)}.settings-title-icon{width:32px;height:32px;background:var(--md3-primary-container);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;font-size:16px}.help-list{color:var(--text-secondary);line-height:2.2;font-size:14px}.help-list p{margin-bottom:8px;display:flex;align-items:center;gap:8px}.help-list code{background:var(--md3-surface-variant);padding:4px 10px;border-radius:var(--radius-sm);font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--md3-primary);border:1px solid var(--md3-outline-variant)}::-webkit-scrollbar{width:10px;height:10px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--md3-outline-variant);border-radius:var(--radius-full);border:2px solid var(--md3-background)}::-webkit-scrollbar-thumb:hover{background:var(--md3-primary)}::selection{background:var(--md3-primary);color:var(--md3-on-primary)}.context-menu{position:fixed;z-index:99999;min-width:180px;background:var(--md3-surface);border:1px solid var(--md3-outline-variant);border-radius:var(--radius-lg);box-shadow:var(--shadow-xl);padding:8px 0;opacity:0;visibility:hidden;transform:translateY(-4px);transition:opacity .1s ease,transform .1s ease,visibility .1s}.context-menu.show{opacity:1;visibility:visible;transform:translateY(0)}.context-menu-item{display:flex;align-items:center;gap:12px;padding:10px 16px;cursor:pointer;transition:all var(--transition-fast);color:var(--text-primary);font-size:14px;font-weight:500}.context-menu-item:hover{background:var(--md3-primary-container);color:var(--md3-on-primary-container)}.context-menu-item-icon{font-size:16px;width:20px;text-align:center;opacity:.8}.context-menu-item-text{flex:1}.context-menu-item-shortcut{font-size:11px;color:var(--text-muted);font-family:'JetBrains Mono',monospace}.context-menu-item.disabled{opacity:.4;cursor:not-allowed;pointer-events:none}.context-menu-divider{height:1px;background:var(--md3-outline-variant);margin:6px 12px}.tooltip{position:fixed;z-index:99998;padding:6px 10px;background:#1a2332;color:#fff;font-size:12px;font-weight:500;border-radius:var(--radius-sm);box-shadow:var(--shadow-lg);opacity:0;visibility:hidden;transition:opacity .1s ease,visibility .1s;pointer-events:none;white-space:nowrap}.tooltip.show{opacity:1;visibility:visible}*:focus{outline:none}*:focus-visible{outline:2px solid var(--md3-primary);outline-offset:2px}@media (max-width:1000px){.sidebar{width:240px}.main-content{padding:24px}}@media (max-width:768px){.sidebar{width:200px}.mode-cards{grid-template-columns:repeat(2,1fr)}}
/* æ–°æ‰‹å¼•å¯¼æ ·å¼ */
.onboarding-overlay{position:fixed;inset:0;background:rgba(0,32,33,.85);backdrop-filter:blur(8px);z-index:20000;display:flex;align-items:center;justify-content:center;opacity:0;visibility:hidden;transition:all .3s ease}.onboarding-overlay.show{opacity:1;visibility:visible}.onboarding-modal{width:90%;max-width:580px;background:var(--md3-surface);border-radius:var(--radius-xl);box-shadow:0 24px 80px rgba(0,0,0,.35);overflow:hidden;transform:scale(.9) translateY(20px);transition:transform .4s cubic-bezier(.4,0,.2,1)}.onboarding-overlay.show .onboarding-modal{transform:scale(1) translateY(0)}.onboarding-header{background:linear-gradient(135deg,var(--md3-primary) 0%,#0097a7 100%);padding:40px 32px 32px;text-align:center;position:relative;overflow:hidden}.onboarding-header::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(255,255,255,.1) 0%,transparent 60%);animation:float 6s ease-in-out infinite}@keyframes float{0%,100%{transform:translate(0,0)}50%{transform:translate(30px,30px)}}.onboarding-logo{font-size:64px;margin-bottom:16px;animation:bounce 1s ease infinite;animation-delay:.5s}@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}.onboarding-welcome{font-size:28px;font-weight:700;color:#fff;margin-bottom:8px;text-shadow:0 2px 8px rgba(0,0,0,.2)}.onboarding-subtitle{font-size:15px;color:rgba(255,255,255,.85);font-weight:400}.onboarding-content{padding:32px}.onboarding-steps{display:none}.onboarding-steps.active{display:block;animation:slideIn .3s ease}@keyframes slideIn{from{opacity:0;transform:translateX(20px)}to{opacity:1;transform:translateX(0)}}.step-title{font-size:20px;font-weight:600;color:var(--text-primary);margin-bottom:20px;display:flex;align-items:center;gap:12px}.step-number{width:32px;height:32px;background:var(--md3-primary);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700}.step-features{display:grid;gap:12px}.feature-item{display:flex;align-items:flex-start;gap:14px;padding:16px;background:var(--md3-surface-variant);border-radius:var(--radius-md);border:1px solid var(--md3-outline-variant)}.feature-icon{font-size:28px;flex-shrink:0}.feature-text h4{font-size:14px;font-weight:600;color:var(--text-primary);margin-bottom:4px}.feature-text p{font-size:13px;color:var(--text-muted);line-height:1.5}.onboarding-footer{padding:24px 32px 32px;display:flex;justify-content:space-between;align-items:center;border-top:1px solid var(--md3-outline-variant)}.onboarding-dots{display:flex;gap:8px}.onboarding-dot{width:10px;height:10px;border-radius:50%;background:var(--md3-outline-variant);transition:all .3s ease;cursor:pointer}.onboarding-dot.active{background:var(--md3-primary);width:28px;border-radius:5px}.onboarding-btns{display:flex;gap:12px}.onboarding-btn{padding:12px 28px;border:none;border-radius:var(--radius-full);font-size:14px;font-weight:600;cursor:pointer;transition:all .2s ease}.onboarding-btn.secondary{background:var(--md3-surface-variant);color:var(--text-secondary)}.onboarding-btn.secondary:hover{background:var(--md3-secondary-container)}.onboarding-btn.primary{background:linear-gradient(135deg,var(--md3-primary) 0%,#0097a7 100%);color:#fff;box-shadow:0 4px 12px rgba(0,188,212,.4)}.onboarding-btn.primary:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(0,188,212,.5)}.confetti{position:fixed;pointer-events:none;z-index:20001}
    </style>
</head>
<body>
    <!-- æ–°æ‰‹å¼•å¯¼ -->
    <div class="onboarding-overlay" id="onboarding">
        <div class="onboarding-modal">
            <div class="onboarding-header">
                <div class="onboarding-logo">ğŸ“š</div>
                <h2 class="onboarding-welcome">æ¬¢è¿ä½¿ç”¨ LoArchive</h2>
                <p class="onboarding-subtitle">Lofter & AO3 å†…å®¹å­˜æ¡£å·¥å…·</p>
            </div>
            <div class="onboarding-content">
                <!-- æ­¥éª¤ 1: åŠŸèƒ½ä»‹ç» -->
                <div class="onboarding-steps active" data-step="1">
                    <h3 class="step-title"><span class="step-number">1</span>ä¸»è¦åŠŸèƒ½</h3>
                    <div class="step-features">
                        <div class="feature-item">
                            <span class="feature-icon">â¤ï¸</span>
                            <div class="feature-text">
                                <h4>Lofter å†…å®¹çˆ¬å–</h4>
                                <p>ä¿å­˜å–œæ¬¢ã€æ¨èã€Tag å†…å®¹ï¼Œæ”¯æŒå›¾ç‰‡å’Œæ–‡ç« æ‰¹é‡ä¸‹è½½</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">ğŸ“š</span>
                            <div class="feature-text">
                                <h4>AO3 æ–‡ç« ä¸‹è½½</h4>
                                <p>ä¸‹è½½ AO3 ä½œå“ã€ç³»åˆ—ã€ä½œè€…å…¨éƒ¨æ–‡ç« ï¼Œæ”¯æŒå¯¼å‡º PDF</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">ğŸ“‘</span>
                            <div class="feature-text">
                                <h4>PDF å¯¼å‡º</h4>
                                <p>å°†ä¸‹è½½çš„å†…å®¹è½¬æ¢ä¸ºç²¾ç¾æ’ç‰ˆçš„ PDF æ–‡ä»¶</p>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- æ­¥éª¤ 2: é…ç½®è¯´æ˜ -->
                <div class="onboarding-steps" data-step="2">
                    <h3 class="step-title"><span class="step-number">2</span>é…ç½®ç™»å½•ä¿¡æ¯</h3>
                    <div class="step-features">
                        <div class="feature-item">
                            <span class="feature-icon">ğŸ”</span>
                            <div class="feature-text">
                                <h4>è·å–æˆæƒç </h4>
                                <p>æ‰“å¼€ Lofter ç½‘é¡µç‰ˆ â†’ æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…· â†’ Application â†’ Cookies</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">ğŸ“</span>
                            <div class="feature-text">
                                <h4>å¡«å†™é…ç½®</h4>
                                <p>åœ¨ã€Œè®¾ç½®ã€é¡µé¢é€‰æ‹©ç™»å½•æ–¹å¼ï¼Œç²˜è´´å¯¹åº”çš„æˆæƒç </p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">âœ¨</span>
                            <div class="feature-text">
                                <h4>AO3 æ— éœ€é…ç½®</h4>
                                <p>AO3 åŠŸèƒ½æ— éœ€ç™»å½•ï¼Œå¯ç›´æ¥ä½¿ç”¨</p>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- æ­¥éª¤ 3: ä½¿ç”¨æŒ‡å— -->
                <div class="onboarding-steps" data-step="3">
                    <h3 class="step-title"><span class="step-number">3</span>å¼€å§‹ä½¿ç”¨</h3>
                    <div class="step-features">
                        <div class="feature-item">
                            <span class="feature-icon">1ï¸âƒ£</span>
                            <div class="feature-text">
                                <h4>é€‰æ‹©åŠŸèƒ½</h4>
                                <p>ä»å·¦ä¾§èœå•é€‰æ‹©éœ€è¦çš„åŠŸèƒ½æ¨¡å—</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">2ï¸âƒ£</span>
                            <div class="feature-text">
                                <h4>å¡«å†™é“¾æ¥</h4>
                                <p>ç²˜è´´è¦çˆ¬å–çš„é¡µé¢é“¾æ¥ï¼Œå¯é€‰æ‹©ä¿å­˜æ ¼å¼</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">3ï¸âƒ£</span>
                            <div class="feature-text">
                                <h4>å¼€å§‹çˆ¬å–</h4>
                                <p>ç‚¹å‡»æŒ‰é’®å¼€å§‹ï¼Œæ–‡ä»¶ä¿å­˜åœ¨ ./dir ç›®å½•</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="onboarding-footer">
                <div class="onboarding-dots">
                    <div class="onboarding-dot active" data-step="1"></div>
                    <div class="onboarding-dot" data-step="2"></div>
                    <div class="onboarding-dot" data-step="3"></div>
                </div>
                <div class="onboarding-btns">
                    <button class="onboarding-btn secondary" id="onboarding-skip">è·³è¿‡</button>
                    <button class="onboarding-btn primary" id="onboarding-next">ä¸‹ä¸€æ­¥ â†’</button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ ‡é¢˜æ  -->
    <div class="titlebar" id="titlebar">
        <div class="titlebar-left">
            <div class="titlebar-logo">ğŸ“š</div>
            <span class="titlebar-title">LoArchive</span>
        </div>
        <div class="titlebar-controls">
            <button class="titlebar-btn btn-minimize" id="btn-minimize" title="æœ€å°åŒ–">
                <svg viewBox="0 0 12 12">
                    <line x1="2" y1="6" x2="10" y2="6"/>
                </svg>
            </button>
            <button class="titlebar-btn btn-maximize" id="btn-maximize" title="æœ€å¤§åŒ–">
                <svg viewBox="0 0 12 12">
                    <rect x="2" y="2" width="8" height="8" rx="1.5"/>
                </svg>
            </button>
            <button class="titlebar-btn btn-close" id="btn-close" title="å…³é—­">
                <svg viewBox="0 0 12 12">
                    <line x1="3" y1="3" x2="9" y2="9"/>
                    <line x1="9" y1="3" x2="3" y2="9"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- ä¸»å®¹å™¨ -->
    <div class="app-container">
        <!-- ä¾§è¾¹æ  -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="brand">
                    <div class="brand-icon">ğŸ“š</div>
                    <div class="brand-text">
                        <h1>LoArchive</h1>
                        <p>Lofter & AO3 å­˜æ¡£å·¥å…·</p>
                    </div>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section-title">Lofter</div>
                
                <div class="nav-item active" data-panel="lst">
                    <span class="nav-icon">â¤ï¸</span>
                    <span class="nav-label">å–œæ¬¢ / æ¨è / Tag</span>
                </div>
                <div class="nav-item" data-panel="author-img">
                    <span class="nav-icon">ğŸ–¼ï¸</span>
                    <span class="nav-label">ä½œè€…å›¾ç‰‡</span>
                </div>
                <div class="nav-item" data-panel="author-txt">
                    <span class="nav-icon">ğŸ“</span>
                    <span class="nav-label">ä½œè€…æ–‡ç« </span>
                </div>
                <div class="nav-item" data-panel="single">
                    <span class="nav-icon">ğŸ“</span>
                    <span class="nav-label">å•ç¯‡ä¿å­˜</span>
                </div>

                <div class="nav-section-title">AO3</div>
                
                <div class="nav-item" data-panel="ao3">
                    <span class="nav-icon">ğŸ“š</span>
                    <span class="nav-label">AO3 æ–‡ç« </span>
                </div>

                <div class="nav-section-title">ç³»ç»Ÿ</div>
                
                <div class="nav-item" data-panel="settings">
                    <span class="nav-icon">âš™ï¸</span>
                    <span class="nav-label">è®¾ç½®</span>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="status-card">
                    <div class="status-row">
                        <span class="status-label">è¿è¡ŒçŠ¶æ€</span>
                        <span class="status-value" id="statusText">
                            <span class="status-dot" id="statusDot"></span>
                            <span id="statusLabel">å°±ç»ª</span>
                        </span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">ç™»å½•çŠ¶æ€</span>
                        <span class="status-value" id="authStatus">æœªé…ç½®</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- ä¸»å†…å®¹ -->
        <main class="main-content">
            <!-- å–œæ¬¢/æ¨è/Tag é¢æ¿ -->
            <div class="panel active" id="panel-lst">
                <div class="panel-header">
                    <h2 class="panel-title">
                        <span class="panel-title-icon">â¤ï¸</span>
                        å–œæ¬¢ / æ¨è / Tag
                    </h2>
                </div>

                <div class="mode-cards">
                    <div class="mode-card selected" data-mode="like2">
                        <div class="mode-card-icon">ğŸ’–</div>
                        <div class="mode-card-name">æˆ‘çš„å–œæ¬¢</div>
                    </div>
                    <div class="mode-card" data-mode="share">
                        <div class="mode-card-icon">ğŸ“¤</div>
                        <div class="mode-card-name">æˆ‘çš„æ¨è</div>
                    </div>
                    <div class="mode-card" data-mode="tag">
                        <div class="mode-card-icon">ğŸ·ï¸</div>
                        <div class="mode-card-name">Tag å†…å®¹</div>
                    </div>
                </div>

                <div class="form-card">
                    <div class="form-group">
                        <label class="form-label">é“¾æ¥åœ°å€</label>
                        <input type="text" class="form-input" id="lstUrl" placeholder="https://ä½ çš„ç”¨æˆ·å.lofter.com/ æˆ– Tag é“¾æ¥">
                        <p class="form-hint">ğŸ’¡ å–œæ¬¢/æ¨èæ¨¡å¼å¡«å†™ä¸ªäººä¸»é¡µé“¾æ¥ï¼ŒTag æ¨¡å¼å¡«å†™ Tag é¡µé¢é“¾æ¥</p>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ä¿å­˜å†…å®¹</label>
                        <div class="checkbox-group">
                            <label class="checkbox-item">
                                <input type="checkbox" id="saveImg" checked>
                                <span>ğŸ“· å›¾ç‰‡</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" id="saveArticle" checked>
                                <span>ğŸ“„ æ–‡ç« </span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" id="saveText" checked>
                                <span>ğŸ“ æ–‡æœ¬</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" id="saveLong" checked>
                                <span>ğŸ“– é•¿æ–‡ç« </span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" id="lstExportPdf">
                                <span>ğŸ“‘ å¯¼å‡ºPDF</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">å¼€å§‹æ—¶é—´ï¼ˆå¯é€‰ï¼‰</label>
                        <input type="date" class="form-input" id="startTime" style="max-width: 280px;">
                    </div>

                    <button class="btn btn-primary btn-block" onclick="startLstTask()">
                        <span class="btn-icon">ğŸš€</span>
                        å¼€å§‹çˆ¬å–
                    </button>
                </div>

                <div class="progress-section" id="progressSection">
                    <div class="progress-card">
                        <div class="progress-header">
                            <span class="progress-title" id="progressMessage">å‡†å¤‡ä¸­...</span>
                            <span class="progress-percent" id="progressPercent">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="log-container" id="logContainer">
                        <div class="log-header">
                            <span class="log-header-title">
                                <span>ğŸ“‹</span>
                                è¿è¡Œæ—¥å¿—
                            </span>
                        </div>
                        <div class="log-content" id="logContent"></div>
                    </div>
                </div>
            </div>

            <!-- ä½œè€…å›¾ç‰‡é¢æ¿ -->
            <div class="panel" id="panel-author-img">
                <div class="panel-header">
                    <h2 class="panel-title">
                        <span class="panel-title-icon">ğŸ–¼ï¸</span>
                        ä½œè€…å›¾ç‰‡
                    </h2>
                </div>
                <div class="form-card">
                    <div class="form-group">
                        <label class="form-label">ä½œè€…ä¸»é¡µé“¾æ¥</label>
                        <input type="text" class="form-input" id="authorImgUrl" placeholder="https://ç”¨æˆ·å.lofter.com/">
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ—¶é—´èŒƒå›´ï¼ˆå¯é€‰ï¼‰</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 14px; max-width: 400px;">
                            <input type="date" class="form-input" id="imgStartTime" placeholder="å¼€å§‹æ—¶é—´">
                            <input type="date" class="form-input" id="imgEndTime" placeholder="ç»“æŸæ—¶é—´">
                        </div>
                    </div>
                    <button class="btn btn-primary btn-block" onclick="startAuthorImgTask()">
                        <span class="btn-icon">ğŸš€</span>
                        å¼€å§‹çˆ¬å–
                    </button>
                </div>
            </div>

            <!-- ä½œè€…æ–‡ç« é¢æ¿ -->
            <div class="panel" id="panel-author-txt">
                <div class="panel-header">
                    <h2 class="panel-title">
                        <span class="panel-title-icon">ğŸ“</span>
                        ä½œè€…æ–‡ç« 
                    </h2>
                </div>
                <div class="form-card">
                    <div class="form-group">
                        <label class="form-label">ä½œè€…ä¸»é¡µé“¾æ¥</label>
                        <input type="text" class="form-input" id="authorTxtUrl" placeholder="https://ç”¨æˆ·å.lofter.com/">
                    </div>
                    <button class="btn btn-primary btn-block" onclick="startAuthorTxtTask()">
                        <span class="btn-icon">ğŸš€</span>
                        å¼€å§‹çˆ¬å–
                    </button>
                </div>
            </div>

            <!-- å•ç¯‡ä¿å­˜é¢æ¿ -->
            <div class="panel" id="panel-single">
                <div class="panel-header">
                    <h2 class="panel-title">
                        <span class="panel-title-icon">ğŸ“</span>
                        å•ç¯‡ä¿å­˜
                    </h2>
                </div>
                <div class="mode-cards">
                    <div class="mode-card selected" data-single-mode="img">
                        <div class="mode-card-icon">ğŸ–¼ï¸</div>
                        <div class="mode-card-name">ä¿å­˜å›¾ç‰‡</div>
                    </div>
                    <div class="mode-card" data-single-mode="txt">
                        <div class="mode-card-icon">ğŸ“</div>
                        <div class="mode-card-name">ä¿å­˜æ–‡ç« </div>
                    </div>
                </div>
                <div class="form-card">
                    <div class="form-group">
                        <label class="form-label">åšå®¢é“¾æ¥ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                        <textarea class="form-input" id="singleUrls" rows="5" placeholder="https://ç”¨æˆ·å.lofter.com/post/xxx&#10;https://ç”¨æˆ·å.lofter.com/post/yyy"></textarea>
                    </div>
                    <button class="btn btn-primary btn-block" onclick="startSingleTask()">
                        <span class="btn-icon">ğŸš€</span>
                        å¼€å§‹ä¿å­˜
                    </button>
                </div>
            </div>

            <!-- AO3 é¢æ¿ -->
            <div class="panel" id="panel-ao3">
                <div class="panel-header">
                    <h2 class="panel-title">
                        <span class="panel-title-icon">ğŸ“š</span>
                        AO3 æ–‡ç« 
                    </h2>
                </div>
                <div class="mode-cards">
                    <div class="mode-card selected" data-ao3-mode="work">
                        <div class="mode-card-icon">ğŸ“–</div>
                        <div class="mode-card-name">å•ç¯‡ä½œå“</div>
                    </div>
                    <div class="mode-card" data-ao3-mode="series">
                        <div class="mode-card-icon">ğŸ“š</div>
                        <div class="mode-card-name">ç³»åˆ—</div>
                    </div>
                    <div class="mode-card" data-ao3-mode="author">
                        <div class="mode-card-icon">ğŸ‘¤</div>
                        <div class="mode-card-name">ä½œè€…</div>
                    </div>
                    <div class="mode-card" data-ao3-mode="tag">
                        <div class="mode-card-icon">ğŸ·ï¸</div>
                        <div class="mode-card-name">Tag</div>
                    </div>
                </div>
                <div class="form-card">
                    <div class="form-group">
                        <label class="form-label">AO3 é“¾æ¥ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                        <textarea class="form-input" id="ao3Urls" rows="4" placeholder="https://archiveofourown.org/works/12345678"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">æœ€å¤§é¡µæ•°</label>
                        <input type="number" class="form-input" id="ao3MaxPages" value="5" min="1" max="50" style="max-width: 140px;">
                        <p class="form-hint">ğŸ’¡ ç”¨äº Tag/ä½œè€…æ¨¡å¼ï¼Œé™åˆ¶çˆ¬å–çš„é¡µæ•°</p>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ä¸‹è½½é€‰é¡¹</label>
                        <div class="checkbox-group">
                            <label class="checkbox-item">
                                <input type="checkbox" id="ao3DownloadChapters" checked>
                                <span>ğŸ“‘ å…¨éƒ¨ç« èŠ‚</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" id="ao3SaveMetadata" checked>
                                <span>ğŸ“‹ å…ƒæ•°æ®</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" id="ao3ExportPdf">
                                <span>ğŸ“„ å¯¼å‡ºPDF</span>
                            </label>
                        </div>
                    </div>
                    <button class="btn btn-primary btn-block" onclick="startAo3Task()">
                        <span class="btn-icon">ğŸš€</span>
                        å¼€å§‹ä¸‹è½½
                    </button>
                </div>
            </div>

            <!-- è®¾ç½®é¢æ¿ -->
            <div class="panel" id="panel-settings">
                <div class="panel-header">
                    <h2 class="panel-title">
                        <span class="panel-title-icon">âš™ï¸</span>
                        è®¾ç½®
                    </h2>
                </div>
                
                <div class="settings-section">
                    <h3 class="settings-title">
                        <span class="settings-title-icon">ğŸ”</span>
                        ç™»å½•é…ç½®
                    </h3>
                    <div class="form-group">
                        <label class="form-label">ç™»å½•æ–¹å¼</label>
                        <select class="form-input" id="loginKey" style="max-width: 320px;">
                            <option value="LOFTER-PHONE-LOGIN-AUTH">æ‰‹æœºå·ç™»å½•</option>
                            <option value="Authorization">Lofter ID ç™»å½•</option>
                            <option value="LOFTER_SESS">QQ/å¾®ä¿¡/å¾®åšç™»å½•</option>
                            <option value="NTES_SESS">é‚®ç®±ç™»å½•</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">æˆæƒç </label>
                        <textarea class="form-input" id="loginAuth" rows="3" placeholder="ä»æµè§ˆå™¨å¼€å‘è€…å·¥å…·è·å–"></textarea>
                        <p class="form-hint">ğŸ’¡ æ‰“å¼€ Lofter â†’ F12 â†’ Application â†’ Cookies â†’ æ‰¾åˆ°å¯¹åº”å€¼</p>
                    </div>
                    <button class="btn btn-primary" onclick="saveConfig()">
                        <span class="btn-icon">ğŸ’¾</span>
                        ä¿å­˜é…ç½®
                    </button>
                </div>

                <div class="settings-section">
                    <h3 class="settings-title">
                        <span class="settings-title-icon">ğŸ“–</span>
                        ä½¿ç”¨è¯´æ˜
                    </h3>
                    <div class="help-list">
                        <p>1ï¸âƒ£ é¦–æ¬¡ä½¿ç”¨è¯·å…ˆåœ¨ä¸Šæ–¹é…ç½®ç™»å½•ä¿¡æ¯</p>
                        <p>2ï¸âƒ£ ä»å·¦ä¾§é€‰æ‹©å¯¹åº”çš„çˆ¬å–åŠŸèƒ½</p>
                        <p>3ï¸âƒ£ å¡«å†™é“¾æ¥åç‚¹å‡»å¼€å§‹æŒ‰é’®</p>
                        <p>4ï¸âƒ£ ä¸‹è½½çš„æ–‡ä»¶ä¿å­˜åœ¨ <code>./dir</code> ç›®å½•</p>
                        <p>5ï¸âƒ£ AO3 åŠŸèƒ½æ— éœ€é…ç½®ç™»å½•ä¿¡æ¯</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
const AppState={currentPanel:'lst',currentMode:'like2',currentSingleMode:'img',currentAo3Mode:'work',isRunning:false,pollInterval:null};document.addEventListener('DOMContentLoaded',()=>{initNavigation();initModeCards();initTauri();initContextMenu();initTooltips();initOnboarding();loadConfig()});
/* æ–°æ‰‹å¼•å¯¼ */
let onboardingStep=1;const totalSteps=3;function initOnboarding(){if(localStorage.getItem('loarchive_onboarding_done')==='true'){return}const overlay=document.getElementById('onboarding');const nextBtn=document.getElementById('onboarding-next');const skipBtn=document.getElementById('onboarding-skip');const dots=document.querySelectorAll('.onboarding-dot');setTimeout(()=>{overlay.classList.add('show')},300);nextBtn.addEventListener('click',()=>{if(onboardingStep<totalSteps){onboardingStep++;updateOnboardingStep()}else{finishOnboarding()}});skipBtn.addEventListener('click',finishOnboarding);dots.forEach(dot=>{dot.addEventListener('click',()=>{onboardingStep=parseInt(dot.dataset.step);updateOnboardingStep()})})}function updateOnboardingStep(){document.querySelectorAll('.onboarding-steps').forEach(s=>s.classList.remove('active'));document.querySelector(`.onboarding-steps[data-step="${onboardingStep}"]`).classList.add('active');document.querySelectorAll('.onboarding-dot').forEach(d=>{d.classList.toggle('active',parseInt(d.dataset.step)===onboardingStep)});const nextBtn=document.getElementById('onboarding-next');if(onboardingStep===totalSteps){nextBtn.textContent='å¼€å§‹ä½¿ç”¨ ğŸš€'}else{nextBtn.textContent='ä¸‹ä¸€æ­¥ â†’'}}function finishOnboarding(){const overlay=document.getElementById('onboarding');overlay.classList.remove('show');localStorage.setItem('loarchive_onboarding_done','true');createConfetti();showNotification('æ¬¢è¿ä½¿ç”¨ï¼å¦‚éœ€æŸ¥çœ‹å¸®åŠ©ï¼Œè¯·å‰å¾€ã€Œè®¾ç½®ã€é¡µé¢','success')}function createConfetti(){const colors=['#00bcd4','#26c6da','#ff6b9d','#ffd700','#00897b'];for(let i=0;i<50;i++){const confetti=document.createElement('div');confetti.className='confetti';confetti.style.cssText=`position:fixed;width:10px;height:10px;background:${colors[Math.floor(Math.random()*colors.length)]};left:${Math.random()*100}vw;top:-20px;border-radius:${Math.random()>.5?'50%':'2px'};z-index:20001;pointer-events:none`;document.body.appendChild(confetti);const duration=2000+Math.random()*2000;const rotation=Math.random()*720-360;confetti.animate([{transform:'translateY(0) rotate(0deg)',opacity:1},{transform:`translateY(100vh) rotate(${rotation}deg)`,opacity:0}],{duration,easing:'cubic-bezier(.25,.46,.45,.94)'});setTimeout(()=>confetti.remove(),duration)}}function initNavigation(){document.querySelectorAll('.nav-item').forEach(item=>{item.addEventListener('click',()=>{switchPanel(item.dataset.panel)})})}function switchPanel(panelId){document.querySelectorAll('.nav-item').forEach(nav=>{nav.classList.toggle('active',nav.dataset.panel===panelId)});document.querySelectorAll('.panel').forEach(panel=>{panel.classList.remove('active')});document.getElementById(`panel-${panelId}`).classList.add('active');AppState.currentPanel=panelId}function initModeCards(){document.querySelectorAll('[data-mode]').forEach(card=>{card.addEventListener('click',()=>{document.querySelectorAll('[data-mode]').forEach(c=>c.classList.remove('selected'));card.classList.add('selected');AppState.currentMode=card.dataset.mode})});document.querySelectorAll('[data-single-mode]').forEach(card=>{card.addEventListener('click',()=>{document.querySelectorAll('[data-single-mode]').forEach(c=>c.classList.remove('selected'));card.classList.add('selected');AppState.currentSingleMode=card.dataset.singleMode})});document.querySelectorAll('[data-ao3-mode]').forEach(card=>{card.addEventListener('click',()=>{document.querySelectorAll('[data-ao3-mode]').forEach(c=>c.classList.remove('selected'));card.classList.add('selected');AppState.currentAo3Mode=card.dataset.ao3Mode})})}function initTauri(){const isTauri=window.__TAURI__!==undefined||window.__TAURI_INTERNALS__!==undefined||navigator.userAgent.includes('Tauri');if(!isTauri){const titlebar=document.getElementById('titlebar');if(titlebar)titlebar.style.display='none';const container=document.querySelector('.app-container');if(container)container.style.paddingTop='0';return}console.log('ğŸ“š LoArchive: Tauri ç¯å¢ƒå·²æ£€æµ‹');const setupWindowControls=async()=>{try{let appWindow;if(window.__TAURI__&&window.__TAURI__.window){const{getCurrentWindow}=window.__TAURI__.window;appWindow=getCurrentWindow()}else{const{getCurrentWindow}=await import('@tauri-apps/api/window');appWindow=getCurrentWindow()}if(!appWindow){console.error('æ— æ³•è·å– Tauri çª—å£å®ä¾‹');return}const btnMinimize=document.getElementById('btn-minimize');const btnMaximize=document.getElementById('btn-maximize');const btnClose=document.getElementById('btn-close');if(btnMinimize)btnMinimize.onclick=()=>appWindow.minimize();if(btnMaximize)btnMaximize.onclick=async()=>{(await appWindow.isMaximized())?appWindow.unmaximize():appWindow.maximize()};if(btnClose)btnClose.onclick=()=>appWindow.close();const titlebarLeft=document.querySelector('.titlebar-left');if(titlebarLeft){titlebarLeft.addEventListener('dblclick',async()=>{(await appWindow.isMaximized())?appWindow.unmaximize():appWindow.maximize()})}console.log('çª—å£æ§åˆ¶æŒ‰é’®å·²ç»‘å®š')}catch(e){console.error('Tauri çª—å£æ§åˆ¶åˆå§‹åŒ–å¤±è´¥:',e)}};if(document.readyState==='complete'){setupWindowControls()}else{window.addEventListener('load',setupWindowControls)}}async function loadConfig(){try{const res=await fetch('/api/config');const data=await res.json();const loginKeyEl=document.getElementById('loginKey');if(loginKeyEl)loginKeyEl.value=data.login_key;updateAuthStatus(data.has_auth)}catch(e){console.error('åŠ è½½é…ç½®å¤±è´¥:',e)}}window.saveConfig=async function(){const loginKey=document.getElementById('loginKey').value;const loginAuth=document.getElementById('loginAuth').value;try{const res=await fetch('/api/config',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({login_key:loginKey,login_auth:loginAuth})});const data=await res.json();if(data.success){showNotification('é…ç½®ä¿å­˜æˆåŠŸï¼','success');loadConfig()}}catch(e){showNotification('ä¿å­˜å¤±è´¥: '+e.message,'error')}};function updateAuthStatus(hasAuth){const el=document.getElementById('authStatus');if(!el)return;if(hasAuth){el.textContent='å·²é…ç½® âœ“';el.classList.add('success');el.classList.remove('error')}else{el.textContent='æœªé…ç½®';el.classList.add('error');el.classList.remove('success')}}window.startLstTask=async function(){const url=document.getElementById('lstUrl').value.trim();if(!url)return showNotification('è¯·è¾“å…¥é“¾æ¥åœ°å€','error');await startTask('like_share_tag',{url,mode:AppState.currentMode,save_mode:{article:document.getElementById('saveArticle').checked?1:0,text:document.getElementById('saveText').checked?1:0,'long article':document.getElementById('saveLong').checked?1:0,img:document.getElementById('saveImg').checked?1:0},start_time:document.getElementById('startTime').value,export_pdf:document.getElementById('lstExportPdf').checked})};window.startAuthorImgTask=async function(){const url=document.getElementById('authorImgUrl').value.trim();if(!url)return showNotification('è¯·è¾“å…¥ä½œè€…ä¸»é¡µé“¾æ¥','error');await startTask('author_img',{author_url:url,start_time:document.getElementById('imgStartTime').value,end_time:document.getElementById('imgEndTime').value})};window.startAuthorTxtTask=async function(){const url=document.getElementById('authorTxtUrl').value.trim();if(!url)return showNotification('è¯·è¾“å…¥ä½œè€…ä¸»é¡µé“¾æ¥','error');await startTask('author_txt',{author_url:url})};window.startSingleTask=async function(){const urls=document.getElementById('singleUrls').value.split('\n').map(u=>u.trim()).filter(u=>u);if(!urls.length)return showNotification('è¯·è¾“å…¥è‡³å°‘ä¸€ä¸ªé“¾æ¥','error');const type=AppState.currentSingleMode==='img'?'single_img':'single_txt';await startTask(type,{urls})};window.startAo3Task=async function(){const urls=document.getElementById('ao3Urls').value.split('\n').map(u=>u.trim()).filter(u=>u);if(!urls.length)return showNotification('è¯·è¾“å…¥è‡³å°‘ä¸€ä¸ª AO3 é“¾æ¥','error');await startTask('ao3',{urls,mode:AppState.currentAo3Mode,download_chapters:document.getElementById('ao3DownloadChapters').checked,save_metadata:document.getElementById('ao3SaveMetadata').checked,export_pdf:document.getElementById('ao3ExportPdf').checked,max_pages:parseInt(document.getElementById('ao3MaxPages').value)||5})};async function startTask(type,params){try{const res=await fetch('/api/task/start',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({type,params})});const data=await res.json();if(data.success){AppState.isRunning=true;updateRunningState(true);showProgress(true);startPolling();showNotification('ä»»åŠ¡å·²å¯åŠ¨','success')}else{showNotification(data.message,'error')}}catch(e){showNotification('å¯åŠ¨å¤±è´¥: '+e.message,'error')}}function showProgress(show){const section=document.getElementById('progressSection');if(section)section.classList.toggle('active',show)}function updateRunningState(running){const dot=document.getElementById('statusDot');const label=document.getElementById('statusLabel');if(dot&&label){if(running){dot.classList.add('running');label.textContent='è¿è¡Œä¸­'}else{dot.classList.remove('running');label.textContent='å°±ç»ª'}}}function startPolling(){if(AppState.pollInterval)clearInterval(AppState.pollInterval);AppState.pollInterval=setInterval(async()=>{try{const res=await fetch('/api/task/status');const data=await res.json();const progressFill=document.getElementById('progressFill');const progressPercent=document.getElementById('progressPercent');const progressMessage=document.getElementById('progressMessage');if(progressFill)progressFill.style.width=data.progress+'%';if(progressPercent)progressPercent.textContent=data.progress+'%';if(progressMessage)progressMessage.textContent=data.message;const logContent=document.getElementById('logContent');if(logContent){logContent.innerHTML=data.logs.map(log=>`<div class="log-line">${escapeHtml(log)}</div>`).join('');logContent.scrollTop=logContent.scrollHeight}if(!data.running&&data.progress>=100){clearInterval(AppState.pollInterval);AppState.isRunning=false;updateRunningState(false);showNotification('ä»»åŠ¡å®Œæˆï¼','success')}}catch(e){console.error('çŠ¶æ€è·å–å¤±è´¥:',e)}},500)}function escapeHtml(text){const div=document.createElement('div');div.textContent=text;return div.innerHTML}function showNotification(message,type='info'){const toast=document.createElement('div');toast.style.cssText='position:fixed;bottom:20px;left:50%;transform:translateX(-50%);padding:12px 24px;border-radius:8px;color:white;box-shadow:0 4px 12px rgba(0,0,0,.15);z-index:10001;font-size:14px;font-weight:500;opacity:0;transition:opacity .3s ease,transform .3s ease';toast.style.background=type==='error'?'#b00020':'#00bcd4';toast.textContent=message;document.body.appendChild(toast);requestAnimationFrame(()=>{toast.style.opacity='1';toast.style.transform='translateX(-50%) translateY(-10px)'});setTimeout(()=>{toast.style.opacity='0';toast.style.transform='translateX(-50%) translateY(0)';setTimeout(()=>document.body.removeChild(toast),300)},3000)}let contextMenu=null;function initContextMenu(){contextMenu=document.createElement('div');contextMenu.className='context-menu';contextMenu.innerHTML=`<div class="context-menu-item" data-action="copy"><span class="context-menu-item-icon">ğŸ“‹</span><span class="context-menu-item-text">å¤åˆ¶</span><span class="context-menu-item-shortcut">Ctrl+C</span></div><div class="context-menu-item" data-action="paste"><span class="context-menu-item-icon">ğŸ“„</span><span class="context-menu-item-text">ç²˜è´´</span><span class="context-menu-item-shortcut">Ctrl+V</span></div><div class="context-menu-item" data-action="cut"><span class="context-menu-item-icon">âœ‚ï¸</span><span class="context-menu-item-text">å‰ªåˆ‡</span><span class="context-menu-item-shortcut">Ctrl+X</span></div><div class="context-menu-divider"></div><div class="context-menu-item" data-action="selectall"><span class="context-menu-item-icon">ğŸ“</span><span class="context-menu-item-text">å…¨é€‰</span><span class="context-menu-item-shortcut">Ctrl+A</span></div><div class="context-menu-divider"></div><div class="context-menu-item" data-action="refresh"><span class="context-menu-item-icon">ğŸ”„</span><span class="context-menu-item-text">åˆ·æ–°é¡µé¢</span><span class="context-menu-item-shortcut">F5</span></div>`;document.body.appendChild(contextMenu);document.addEventListener('contextmenu',(e)=>{e.preventDefault();showContextMenu(e.clientX,e.clientY,e.target)});document.addEventListener('click',()=>hideContextMenu());document.addEventListener('keydown',(e)=>{if(e.key==='Escape')hideContextMenu()});contextMenu.querySelectorAll('.context-menu-item').forEach(item=>{item.addEventListener('click',(e)=>{e.stopPropagation();executeContextAction(item.dataset.action);hideContextMenu()})})}function showContextMenu(x,y,target){updateContextMenuItems(target);contextMenu.classList.add('show');const menuRect=contextMenu.getBoundingClientRect();let posX=x,posY=y;if(x+menuRect.width>window.innerWidth)posX=window.innerWidth-menuRect.width-10;if(y+menuRect.height>window.innerHeight)posY=window.innerHeight-menuRect.height-10;contextMenu.style.left=posX+'px';contextMenu.style.top=posY+'px'}function hideContextMenu(){if(contextMenu)contextMenu.classList.remove('show')}function updateContextMenuItems(target){const hasSelection=window.getSelection().toString().length>0;const isEditable=target.tagName==='INPUT'||target.tagName==='TEXTAREA'||target.isContentEditable;const copyItem=contextMenu.querySelector('[data-action="copy"]');if(copyItem)copyItem.classList.toggle('disabled',!hasSelection);const cutItem=contextMenu.querySelector('[data-action="cut"]');if(cutItem)cutItem.classList.toggle('disabled',!hasSelection||!isEditable);const pasteItem=contextMenu.querySelector('[data-action="paste"]');if(pasteItem)pasteItem.classList.toggle('disabled',!isEditable)}async function executeContextAction(action){switch(action){case 'copy':try{const selection=window.getSelection().toString();if(selection){await navigator.clipboard.writeText(selection);showNotification('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿','success')}}catch(e){document.execCommand('copy')}break;case 'paste':try{const text=await navigator.clipboard.readText();const activeEl=document.activeElement;if(activeEl.tagName==='INPUT'||activeEl.tagName==='TEXTAREA'){const start=activeEl.selectionStart;const end=activeEl.selectionEnd;activeEl.value=activeEl.value.slice(0,start)+text+activeEl.value.slice(end);activeEl.selectionStart=activeEl.selectionEnd=start+text.length}}catch(e){document.execCommand('paste')}break;case 'cut':try{const selection=window.getSelection().toString();if(selection){await navigator.clipboard.writeText(selection);document.execCommand('delete');showNotification('å·²å‰ªåˆ‡åˆ°å‰ªè´´æ¿','success')}}catch(e){document.execCommand('cut')}break;case 'selectall':const activeEl=document.activeElement;if(activeEl.tagName==='INPUT'||activeEl.tagName==='TEXTAREA'){activeEl.select()}else{document.execCommand('selectAll')}break;case 'refresh':window.location.reload();break}}let tooltipEl=null;function initTooltips(){tooltipEl=document.createElement('div');tooltipEl.className='tooltip';document.body.appendChild(tooltipEl);document.querySelectorAll('[title]').forEach(el=>{const title=el.getAttribute('title');el.removeAttribute('title');el.dataset.tooltip=title;el.addEventListener('mouseenter',showTooltip);el.addEventListener('mouseleave',hideTooltip);el.addEventListener('mousemove',moveTooltip)})}function showTooltip(e){const text=e.target.dataset.tooltip;if(!text)return;tooltipEl.textContent=text;tooltipEl.classList.add('show','top');positionTooltip(e)}function hideTooltip(){tooltipEl.classList.remove('show')}function moveTooltip(e){positionTooltip(e)}function positionTooltip(e){const x=e.clientX;const y=e.clientY;const rect=tooltipEl.getBoundingClientRect();let posX=x-rect.width/2;let posY=y-rect.height-12;if(posX<10)posX=10;if(posX+rect.width>window.innerWidth-10)posX=window.innerWidth-rect.width-10;if(posY<10){posY=y+20;tooltipEl.classList.remove('top');tooltipEl.classList.add('bottom')}tooltipEl.style.left=posX+'px';tooltipEl.style.top=posY+'px'}
    </script>
</body>
</html>
